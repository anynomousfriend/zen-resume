"use client"

import React, { useState, useEffect, useRef } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { ThemeToggle } from '@/components/theme-toggle';
import { 
  Plus, Trash2, ArrowLeft, Download, Save
} from 'lucide-react';
import Link from 'next/link';
import { generateLatex } from '@/lib/latex-generator';
import { generateModernLatex } from '@/lib/latex-modern-generator';
import AcademicPreview from '@/components/preview-academic';
import ModernPreview from '@/components/preview-modern';

interface PersonalInfo {
  fullName: string;
  email: string;
  phone: string;
  location: string;
  title: string;
  summary: string;
}

interface Experience {
  id: string;
  company: string;
  position: string;
  startDate: string;
  endDate: string;
  description: string;
}

interface Education {
  id: string;
  school: string;
  degree: string;
  field: string;
  graduationDate: string;
}

interface Skill {
  id: string;
  name: string;
  level: string;
}

interface Project {
  id: string;
  title: string;
  description: string;
  technologies: string;
  link: string;
}

interface Certification {
  id: string;
  name: string;
  issuer: string;
  date: string;
  credentialId: string;
}

interface Language {
  id: string;
  name: string;
  proficiency: string;
}

interface Publication {
  id: string;
  type: string; // 'reviewed' | 'non-reviewed' | 'book' | 'chapter' | 'abstract' | 'other'
  citation: string;
}

interface CreativeWork {
  id: string;
  type: string; // 'publication' | 'presentation' | 'performance' | 'exhibition' | 'project'
  description: string;
}

interface Grant {
  id: string;
  type: string; // 'external' | 'internal'
  status: string; // 'funded' | 'pending' | 'not-funded'
  title: string;
  agency: string;
  role: string;
  effort: string;
  budget: string;
  period: string;
}

interface Teaching {
  id: string;
  type: string; // 'course' | 'grad-supervision' | 'undergrad-supervision' | 'advising'
  title: string;
  details: string;
}

interface SectionTitles {
  education: string;
  publications: string;
  creativeActivity: string;
  grants: string;
  teaching: string;
  service: string;
}

export default function BuilderPage() {
  const [personalInfo, setPersonalInfo] = useState<PersonalInfo>({
    fullName: '',
    email: '',
    phone: '',
    location: '',
    title: '',
    summary: ''
  });
  const [experiences, setExperiences] = useState<Experience[]>([]);
  const [education, setEducation] = useState<Education[]>([]);
  const [skills, setSkills] = useState<Skill[]>([]);
  const [projects, setProjects] = useState<Project[]>([]);
  const [certifications, setCertifications] = useState<Certification[]>([]);
  const [languages, setLanguages] = useState<Language[]>([]);
  const [publications, setPublications] = useState<Publication[]>([]);
  const [creativeWorks, setCreativeWorks] = useState<CreativeWork[]>([]);
  const [grants, setGrants] = useState<Grant[]>([]);
  const [teachingEntries, setTeachingEntries] = useState<Teaching[]>([]);
  const [sectionTitles, setSectionTitles] = useState<SectionTitles>({
    education: 'EDUCATION & EMPLOYMENT HISTORY',
    publications: 'PUBLICATIONS',
    creativeActivity: 'CREATIVE ACTIVITY',
    grants: 'GRANTS',
    teaching: 'TEACHING AND ADVISING',
    service: 'SERVICE & PROFESSIONAL DEVELOPMENT'
  });
  const [isSaved, setIsSaved] = useState(true);
  const [isExporting, setIsExporting] = useState(false);
  const [isAtsMode, setIsAtsMode] = useState(false);
  const [activeTemplate, setActiveTemplate] = useState<'academic' | 'modern'>('modern');
  const [viewMode, setViewMode] = useState<'edit' | 'preview'>('edit');
  const previewRef = useRef<HTMLDivElement>(null);

  // Auto-save to localStorage
  useEffect(() => {
    const timer = setTimeout(() => {
      localStorage.setItem('resume-data', JSON.stringify({
        personalInfo,
        experiences,
        education,
        skills,
        projects,
        certifications,
        languages,
        publications,
        creativeWorks,
        grants,
        teachingEntries,
        sectionTitles,
        isAtsMode
      }));
      setIsSaved(true);
    }, 1000);
    
    setIsSaved(false);
    return () => clearTimeout(timer);
  }, [personalInfo, experiences, education, skills, projects, certifications, languages, publications, creativeWorks, grants, teachingEntries, sectionTitles, isAtsMode]);

  // Load from localStorage on mount
  useEffect(() => {
    const saved = localStorage.getItem('resume-data');
    if (saved) {
      const data = JSON.parse(saved);
      setPersonalInfo(data.personalInfo || personalInfo);
      setExperiences(data.experiences || experiences);
      setEducation(data.education || education);
      setSkills(data.skills || skills);
      setProjects(data.projects || projects);
      setCertifications(data.certifications || certifications);
      setLanguages(data.languages || languages);
      setPublications(data.publications || publications);
      setCreativeWorks(data.creativeWorks || creativeWorks);
      setGrants(data.grants || grants);
      setTeachingEntries(data.teachingEntries || teachingEntries);
      setSectionTitles(data.sectionTitles || sectionTitles);
      setIsAtsMode(data.isAtsMode || false);
    }
  }, []);

  const addExperience = () => {
    setExperiences([...experiences, {
      id: Date.now().toString(),
      company: '',
      position: '',
      startDate: '',
      endDate: '',
      description: ''
    }]);
  };

  const removeExperience = (id: string) => {
    setExperiences(experiences.filter(exp => exp.id !== id));
  };

  const addEducation = () => {
    setEducation([...education, {
      id: Date.now().toString(),
      school: '',
      degree: '',
      field: '',
      graduationDate: ''
    }]);
  };

  const removeEducation = (id: string) => {
    setEducation(education.filter(edu => edu.id !== id));
  };

  const addSkill = () => {
    setSkills([...skills, {
      id: Date.now().toString(),
      name: '',
      level: 'intermediate'
    }]);
  };

  const removeSkill = (id: string) => {
    setSkills(skills.filter(skill => skill.id !== id));
  };

  const addProject = () => {
    setProjects([...projects, {
      id: Date.now().toString(),
      title: '',
      description: '',
      technologies: '',
      link: ''
    }]);
  };

  const removeProject = (id: string) => {
    setProjects(projects.filter(proj => proj.id !== id));
  };

  const addCertification = () => {
    setCertifications([...certifications, {
      id: Date.now().toString(),
      name: '',
      issuer: '',
      date: '',
      credentialId: ''
    }]);
  };

  const removeCertification = (id: string) => {
    setCertifications(certifications.filter(cert => cert.id !== id));
  };

  const addLanguage = () => {
    setLanguages([...languages, {
      id: Date.now().toString(),
      name: '',
      proficiency: 'intermediate'
    }]);
  };

  const removeLanguage = (id: string) => {
    setLanguages(languages.filter(lang => lang.id !== id));
  };

  const addPublication = () => {
    setPublications([...publications, {
      id: Date.now().toString(),
      type: 'reviewed',
      citation: ''
    }]);
  };

  const removePublication = (id: string) => {
    setPublications(publications.filter(pub => pub.id !== id));
  };

  const addCreativeWork = () => {
    setCreativeWorks([...creativeWorks, {
      id: Date.now().toString(),
      type: 'project',
      description: ''
    }]);
  };

  const removeCreativeWork = (id: string) => {
    setCreativeWorks(creativeWorks.filter(work => work.id !== id));
  };

  const addGrant = () => {
    setGrants([...grants, {
      id: Date.now().toString(),
      type: 'external',
      status: 'funded',
      title: '',
      agency: '',
      role: '',
      effort: '',
      budget: '',
      period: ''
    }]);
  };

  const removeGrant = (id: string) => {
    setGrants(grants.filter(grant => grant.id !== id));
  };

  const addTeaching = () => {
    setTeachingEntries([...teachingEntries, {
      id: Date.now().toString(),
      type: 'course',
      title: '',
      details: ''
    }]);
  };

  const removeTeaching = (id: string) => {
    setTeachingEntries(teachingEntries.filter(entry => entry.id !== id));
  };

  const clearAll = () => {
    if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
      // Clear all state
      setPersonalInfo({
        fullName: '',
        email: '',
        phone: '',
        location: '',
        title: '',
        summary: ''
      });
      setExperiences([]);
      setEducation([]);
      setSkills([]);
      setProjects([]);
      setCertifications([]);
      setLanguages([]);
      setPublications([]);
      setCreativeWorks([]);
      setGrants([]);
      setTeachingEntries([]);
      setSectionTitles({
        education: 'EDUCATION & EMPLOYMENT HISTORY',
        publications: 'PUBLICATIONS',
        creativeActivity: 'CREATIVE ACTIVITY',
        grants: 'GRANTS',
        teaching: 'TEACHING AND ADVISING',
        service: 'SERVICE & PROFESSIONAL DEVELOPMENT'
      });
      setIsAtsMode(false);
      
      // Clear localStorage
      localStorage.removeItem('resume-data');
      setIsSaved(true);
    }
  };

  const downloadLatex = () => {
    setIsExporting(true);
    try {
      const latexCode = activeTemplate === 'academic' 
        ? generateLatex({
            personalInfo,
            experiences,
            education,
            publications,
            creativeWorks,
            grants,
            teachingEntries,
            sectionTitles
          })
        : generateModernLatex({
            personalInfo,
            experiences,
            education,
            projects,
            skills
          });
      
      const blob = new Blob([latexCode], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      const fileName = personalInfo.fullName.replace(/\s+/g, '_') || 'cv';
      const templateSuffix = activeTemplate === 'academic' ? '_academic' : '_modern';
      link.download = `${fileName}${templateSuffix}.tex`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('Error exporting LaTeX:', error);
    } finally {
      setIsExporting(false);
    }
  };

  return (
    <main className="min-h-screen bg-white dark:bg-gray-950 transition-colors duration-500">
      {/* Minimal Header */}
      <header className="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-gray-950/80 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800">
        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
          <Link href="/" className="flex items-center space-x-2 group">
            <ArrowLeft className="w-4 h-4 text-gray-400 group-hover:text-blossom-500 transition-colors" />
            <span className="text-sm font-medium text-gray-600 dark:text-gray-400 group-hover:text-blossom-500 transition-colors">
              Back
            </span>
          </Link>
          <div className="flex items-center space-x-3">
            <span className="text-xs text-gray-400">
              {isSaved ? '‚úì Saved' : 'Saving...'}
            </span>
            <div className="flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-900 rounded-lg">
              <button
                onClick={() => setViewMode('edit')}
                className={`text-xs font-medium px-3 py-1.5 rounded transition-colors ${
                  viewMode === 'edit'
                    ? 'bg-white dark:bg-gray-800 text-blossom-600 dark:text-blossom-400 shadow-sm' 
                    : 'text-gray-500 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'
                }`}
              >
                ‚úèÔ∏è Edit
              </button>
              <button
                onClick={() => setViewMode('preview')}
                className={`text-xs font-medium px-3 py-1.5 rounded transition-colors ${
                  viewMode === 'preview'
                    ? 'bg-white dark:bg-gray-800 text-blossom-600 dark:text-blossom-400 shadow-sm' 
                    : 'text-gray-500 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'
                }`}
              >
                üëÅÔ∏è Preview
              </button>
            </div>
            <div className="flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-900 rounded-lg">
              <button
                onClick={() => setIsAtsMode(false)}
                className={`text-xs font-medium px-2 py-1 rounded transition-colors ${
                  !isAtsMode 
                    ? 'bg-white dark:bg-gray-800 text-blossom-600 dark:text-blossom-400 shadow-sm' 
                    : 'text-gray-500 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'
                }`}
              >
                Human
              </button>
              <button
                onClick={() => setIsAtsMode(true)}
                className={`text-xs font-medium px-2 py-1 rounded transition-colors ${
                  isAtsMode 
                    ? 'bg-white dark:bg-gray-800 text-blossom-600 dark:text-blossom-400 shadow-sm' 
                    : 'text-gray-500 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'
                }`}
              >
                ATS
              </button>
            </div>
            <Button 
              variant="ghost" 
              size="sm" 
              className="text-gray-600 hover:text-red-500"
              onClick={clearAll}
            >
              <Trash2 className="w-4 h-4 mr-1.5" />
              Clear All
            </Button>
            <Button 
              variant="ghost" 
              size="sm" 
              className="text-gray-600 hover:text-blossom-500"
              onClick={downloadLatex}
              disabled={isExporting}
            >
              <Download className="w-4 h-4 mr-1.5" />
              {isExporting ? 'Downloading...' : 'Download .tex'}
            </Button>
            <ThemeToggle />
          </div>
        </div>
      </header>

      {/* Single View: Either Editor or Preview */}
      <div className="pt-[73px]">
        {viewMode === 'edit' ? (
          /* Edit Mode: Form Editor */
          <div className="h-screen overflow-y-auto">
            <div className="max-w-4xl mx-auto px-8 py-12 space-y-12">
            
            {/* Section Titles Customization */}
            <section className="space-y-6 pb-8 border-b-2 border-gray-200 dark:border-gray-800">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Customize Section Titles
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Rename sections to match your field (e.g., &ldquo;Research&rdquo; instead of &ldquo;Publications&rdquo;)
                </p>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Education Section</Label>
                  <Input
                    placeholder="EDUCATION & EMPLOYMENT HISTORY"
                    value={sectionTitles.education}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, education: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Publications Section</Label>
                  <Input
                    placeholder="PUBLICATIONS"
                    value={sectionTitles.publications}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, publications: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Creative Activity Section</Label>
                  <Input
                    placeholder="CREATIVE ACTIVITY"
                    value={sectionTitles.creativeActivity}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, creativeActivity: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Grants Section</Label>
                  <Input
                    placeholder="GRANTS"
                    value={sectionTitles.grants}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, grants: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Teaching Section</Label>
                  <Input
                    placeholder="TEACHING AND ADVISING"
                    value={sectionTitles.teaching}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, teaching: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Service Section</Label>
                  <Input
                    placeholder="SERVICE & PROFESSIONAL DEVELOPMENT"
                    value={sectionTitles.service}
                    onChange={(e) => setSectionTitles({ ...sectionTitles, service: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
              </div>
            </section>

            {/* Personal Info Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Personal Information
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your contact details
                </p>
              </div>
              <div className="space-y-4">
                <div className="space-y-1.5 group">
                  <Label htmlFor="fullName" className="text-xs font-medium text-gray-700 dark:text-gray-300 transition-colors group-focus-within:text-blossom-500">Full Name</Label>
                  <Input
                    id="fullName"
                    placeholder="Jane Smith"
                    value={personalInfo.fullName}
                    onChange={(e) => setPersonalInfo({ ...personalInfo, fullName: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 transition-all duration-200"
                  />
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-1.5">
                    <Label htmlFor="email" className="text-xs font-medium text-gray-700 dark:text-gray-300">Email</Label>
                    <Input
                      id="email"
                      type="email"
                      placeholder="jane@email.com"
                      value={personalInfo.email}
                      onChange={(e) => setPersonalInfo({ ...personalInfo, email: e.target.value })}
                      className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                    />
                  </div>
                  <div className="space-y-1.5">
                    <Label htmlFor="phone" className="text-xs font-medium text-gray-700 dark:text-gray-300">Phone</Label>
                    <Input
                      id="phone"
                      placeholder="(555) 123-4567"
                      value={personalInfo.phone}
                      onChange={(e) => setPersonalInfo({ ...personalInfo, phone: e.target.value })}
                      className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                    />
                  </div>
                </div>
                <div className="space-y-1.5">
                  <Label htmlFor="location" className="text-xs font-medium text-gray-700 dark:text-gray-300">Location</Label>
                  <Input
                    id="location"
                    placeholder="San Francisco, CA"
                    value={personalInfo.location}
                    onChange={(e) => setPersonalInfo({ ...personalInfo, location: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label htmlFor="title" className="text-xs font-medium text-gray-700 dark:text-gray-300">Professional Title</Label>
                  <Input
                    id="title"
                    placeholder="Senior Software Engineer"
                    value={personalInfo.title}
                    onChange={(e) => setPersonalInfo({ ...personalInfo, title: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                  />
                </div>
                <div className="space-y-1.5">
                  <Label htmlFor="summary" className="text-xs font-medium text-gray-700 dark:text-gray-300">Professional Summary</Label>
                  <Textarea
                    id="summary"
                    rows={4}
                    placeholder="A brief overview of your professional background..."
                    value={personalInfo.summary}
                    onChange={(e) => setPersonalInfo({ ...personalInfo, summary: e.target.value })}
                    className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                  />
                </div>
              </div>
            </section>

            {/* Experience Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Experience
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your work history
                </p>
              </div>
              <div className="space-y-6">
                {experiences.length === 0 ? (
                  <div className="text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg">
                    <p className="text-sm text-gray-400 dark:text-gray-600 mb-3">No experience added yet</p>
                    <Button
                      onClick={addExperience}
                      variant="outline"
                      className="border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Your First Experience
                    </Button>
                  </div>
                ) : (
                  <>
                    {experiences.map((exp, index) => (
                  <div key={exp.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Position {index + 1}</span>
                      {experiences.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeExperience(exp.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Company</Label>
                          <Input
                            placeholder="Company Name"
                            value={exp.company}
                            onChange={(e) => {
                              const updated = [...experiences];
                              updated[index].company = e.target.value;
                              setExperiences(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Position</Label>
                          <Input
                            placeholder="Job Title"
                            value={exp.position}
                            onChange={(e) => {
                              const updated = [...experiences];
                              updated[index].position = e.target.value;
                              setExperiences(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Start Date</Label>
                          <Input
                            type="month"
                            value={exp.startDate}
                            onChange={(e) => {
                              const updated = [...experiences];
                              updated[index].startDate = e.target.value;
                              setExperiences(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">End Date</Label>
                          <Input
                            type="month"
                            placeholder="Present"
                            value={exp.endDate}
                            onChange={(e) => {
                              const updated = [...experiences];
                              updated[index].endDate = e.target.value;
                              setExperiences(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Description</Label>
                        <Textarea
                          rows={3}
                          placeholder="Key responsibilities and achievements..."
                          value={exp.description}
                          onChange={(e) => {
                            const updated = [...experiences];
                            updated[index].description = e.target.value;
                            setExperiences(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                        />
                      </div>
                    </div>
                  </div>
                ))}
                    <Button
                      onClick={addExperience}
                      variant="outline"
                      className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Another Experience
                    </Button>
                  </>
                )}
              </div>
            </section>

            {/* Education Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Education
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your academic background
                </p>
              </div>
              <div className="space-y-6">
                {education.length === 0 ? (
                  <div className="text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg">
                    <p className="text-sm text-gray-400 dark:text-gray-600 mb-3">No education added yet</p>
                    <Button
                      onClick={addEducation}
                      variant="outline"
                      className="border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Your First Education
                    </Button>
                  </div>
                ) : (
                  <>
                    {education.map((edu, index) => (
                  <div key={edu.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Education {index + 1}</span>
                      {education.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeEducation(edu.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">School/University</Label>
                          <Input
                            placeholder="University Name"
                            value={edu.school}
                            onChange={(e) => {
                              const updated = [...education];
                              updated[index].school = e.target.value;
                              setEducation(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Degree</Label>
                          <Input
                            placeholder="Bachelor's, Master's, etc."
                            value={edu.degree}
                            onChange={(e) => {
                              const updated = [...education];
                              updated[index].degree = e.target.value;
                              setEducation(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Field of Study</Label>
                          <Input
                            placeholder="Computer Science"
                            value={edu.field}
                            onChange={(e) => {
                              const updated = [...education];
                              updated[index].field = e.target.value;
                              setEducation(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Graduation Date</Label>
                          <Input
                            type="month"
                            value={edu.graduationDate}
                            onChange={(e) => {
                              const updated = [...education];
                              updated[index].graduationDate = e.target.value;
                              setEducation(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
                    <Button
                      onClick={addEducation}
                      variant="outline"
                      className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Another Education
                    </Button>
                  </>
                )}
              </div>
            </section>

            {/* Skills Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Skills
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your technical and soft skills
                </p>
              </div>
              <div className="space-y-6">
                {skills.length === 0 ? (
                  <div className="text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg">
                    <p className="text-sm text-gray-400 dark:text-gray-600 mb-3">No skills added yet</p>
                    <Button
                      onClick={addSkill}
                      variant="outline"
                      className="border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Your First Skill
                    </Button>
                  </div>
                ) : (
                  <>
                    {skills.map((skill, index) => (
                  <div key={skill.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Skill {index + 1}</span>
                      {skills.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeSkill(skill.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Skill Name</Label>
                          <Input
                            placeholder="e.g. JavaScript, Leadership"
                            value={skill.name}
                            onChange={(e) => {
                              const updated = [...skills];
                              updated[index].name = e.target.value;
                              setSkills(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Proficiency</Label>
                          <select
                            className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                            value={skill.level}
                            onChange={(e) => {
                              const updated = [...skills];
                              updated[index].level = e.target.value;
                              setSkills(updated);
                            }}
                          >
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                            <option value="expert">Expert</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
                    <Button
                      onClick={addSkill}
                      variant="outline"
                      className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Another Skill
                    </Button>
                  </>
                )}
              </div>
            </section>

            {/* Projects Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Projects
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your notable projects and work
                </p>
              </div>
              <div className="space-y-6">
                {projects.length === 0 ? (
                  <div className="text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg">
                    <p className="text-sm text-gray-400 dark:text-gray-600 mb-3">No projects added yet</p>
                    <Button
                      onClick={addProject}
                      variant="outline"
                      className="border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                    >
                      <Plus className="w-4 h-4 mr-2" />
                      Add Your First Project
                    </Button>
                  </div>
                ) : (
                  <>
                    {projects.map((project, index) => (
                  <div key={project.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Project {index + 1}</span>
                      {projects.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeProject(project.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Project Title</Label>
                        <Input
                          placeholder="E-commerce Platform"
                          value={project.title}
                          onChange={(e) => {
                            const updated = [...projects];
                            updated[index].title = e.target.value;
                            setProjects(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 transition-all duration-200"
                        />
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Description</Label>
                        <Textarea
                          rows={3}
                          placeholder="Brief description of the project and your contributions..."
                          value={project.description}
                          onChange={(e) => {
                            const updated = [...projects];
                            updated[index].description = e.target.value;
                            setProjects(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                        />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Technologies</Label>
                          <Input
                            placeholder="React, Node.js, MongoDB"
                            value={project.technologies}
                            onChange={(e) => {
                              const updated = [...projects];
                              updated[index].technologies = e.target.value;
                              setProjects(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Link (Optional)</Label>
                          <Input
                            placeholder="https://project.com"
                            value={project.link}
                            onChange={(e) => {
                              const updated = [...projects];
                              updated[index].link = e.target.value;
                              setProjects(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addProject}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Project
                </Button>
              </>
            )}
          </div>
        </section>

            {/* Certifications Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Certifications
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your professional certifications
                </p>
              </div>
              <div className="space-y-6">
                {certifications.map((cert, index) => (
                  <div key={cert.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Certification {index + 1}</span>
                      {certifications.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeCertification(cert.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Certification Name</Label>
                          <Input
                            placeholder="AWS Certified Solutions Architect"
                            value={cert.name}
                            onChange={(e) => {
                              const updated = [...certifications];
                              updated[index].name = e.target.value;
                              setCertifications(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Issuing Organization</Label>
                          <Input
                            placeholder="Amazon Web Services"
                            value={cert.issuer}
                            onChange={(e) => {
                              const updated = [...certifications];
                              updated[index].issuer = e.target.value;
                              setCertifications(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Issue Date</Label>
                          <Input
                            type="month"
                            value={cert.date}
                            onChange={(e) => {
                              const updated = [...certifications];
                              updated[index].date = e.target.value;
                              setCertifications(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Credential ID (Optional)</Label>
                          <Input
                            placeholder="ABC123XYZ"
                            value={cert.credentialId}
                            onChange={(e) => {
                              const updated = [...certifications];
                              updated[index].credentialId = e.target.value;
                              setCertifications(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addCertification}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Certification
                </Button>
              </div>
            </section>

            {/* Languages Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Languages
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Languages you speak
                </p>
              </div>
              <div className="space-y-6">
                {languages.map((lang, index) => (
                  <div key={lang.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Language {index + 1}</span>
                      {languages.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeLanguage(lang.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Language</Label>
                          <Input
                            placeholder="English, Spanish, etc."
                            value={lang.name}
                            onChange={(e) => {
                              const updated = [...languages];
                              updated[index].name = e.target.value;
                              setLanguages(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Proficiency</Label>
                          <select
                            className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                            value={lang.proficiency}
                            onChange={(e) => {
                              const updated = [...languages];
                              updated[index].proficiency = e.target.value;
                              setLanguages(updated);
                            }}
                          >
                            <option value="native">Native</option>
                            <option value="fluent">Fluent</option>
                            <option value="advanced">Advanced</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="beginner">Beginner</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addLanguage}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Language
                </Button>
              </div>
            </section>

            {/* Publications Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Publications
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your academic publications
                </p>
              </div>
              <div className="space-y-6">
                {publications.map((pub, index) => (
                  <div key={pub.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Publication {index + 1}</span>
                      {publications.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removePublication(pub.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Type</Label>
                        <select
                          className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                          value={pub.type}
                          onChange={(e) => {
                            const updated = [...publications];
                            updated[index].type = e.target.value;
                            setPublications(updated);
                          }}
                        >
                          <option value="reviewed">Reviewed Article</option>
                          <option value="non-reviewed">Non-Reviewed Article</option>
                          <option value="book">Book</option>
                          <option value="chapter">Book Chapter</option>
                          <option value="abstract">Abstract</option>
                          <option value="other">Other</option>
                        </select>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Full Citation</Label>
                        <Textarea
                          rows={3}
                          placeholder="Author(s). (Year). Title. Journal/Publisher, Volume(Issue), pages. DOI/URL"
                          value={pub.citation}
                          onChange={(e) => {
                            const updated = [...publications];
                            updated[index].citation = e.target.value;
                            setPublications(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                        />
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addPublication}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Publication
                </Button>
              </div>
            </section>

            {/* Creative Activity Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Creative Activity
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Publications, presentations, performances, exhibitions, projects
                </p>
              </div>
              <div className="space-y-6">
                {creativeWorks.map((work, index) => (
                  <div key={work.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Work {index + 1}</span>
                      {creativeWorks.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeCreativeWork(work.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Type</Label>
                        <select
                          className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                          value={work.type}
                          onChange={(e) => {
                            const updated = [...creativeWorks];
                            updated[index].type = e.target.value;
                            setCreativeWorks(updated);
                          }}
                        >
                          <option value="publication">Publication</option>
                          <option value="presentation">Presentation</option>
                          <option value="performance">Performance</option>
                          <option value="exhibition">Exhibition</option>
                          <option value="project">Project</option>
                        </select>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Description</Label>
                        <Textarea
                          rows={3}
                          placeholder="Detailed description of the creative work..."
                          value={work.description}
                          onChange={(e) => {
                            const updated = [...creativeWorks];
                            updated[index].description = e.target.value;
                            setCreativeWorks(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                        />
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addCreativeWork}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Creative Work
                </Button>
              </div>
            </section>

            {/* Grants Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Grants
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your grant proposals and funding
                </p>
              </div>
              <div className="space-y-6">
                {grants.map((grant, index) => (
                  <div key={grant.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Grant {index + 1}</span>
                      {grants.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeGrant(grant.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Type</Label>
                          <select
                            className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                            value={grant.type}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].type = e.target.value;
                              setGrants(updated);
                            }}
                          >
                            <option value="external">External Grant</option>
                            <option value="internal">Internal Grant</option>
                          </select>
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Status</Label>
                          <select
                            className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                            value={grant.status}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].status = e.target.value;
                              setGrants(updated);
                            }}
                          >
                            <option value="funded">Funded</option>
                            <option value="pending">Pending</option>
                            <option value="not-funded">Not Funded</option>
                          </select>
                        </div>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Proposal Title</Label>
                        <Input
                          placeholder="Title of the grant proposal"
                          value={grant.title}
                          onChange={(e) => {
                            const updated = [...grants];
                            updated[index].title = e.target.value;
                            setGrants(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                        />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Funding Agency</Label>
                          <Input
                            placeholder="e.g., NSF, NIH"
                            value={grant.agency}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].agency = e.target.value;
                              setGrants(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Role</Label>
                          <Input
                            placeholder="PI, Co-PI, etc."
                            value={grant.role}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].role = e.target.value;
                              setGrants(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Effort %</Label>
                          <Input
                            placeholder="e.g., 20%"
                            value={grant.effort}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].effort = e.target.value;
                              setGrants(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                        <div className="space-y-1.5">
                          <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Budget</Label>
                          <Input
                            placeholder="e.g., $500,000"
                            value={grant.budget}
                            onChange={(e) => {
                              const updated = [...grants];
                              updated[index].budget = e.target.value;
                              setGrants(updated);
                            }}
                            className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                          />
                        </div>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Coverage Period</Label>
                        <Input
                          placeholder="e.g., 2023-2026"
                          value={grant.period}
                          onChange={(e) => {
                            const updated = [...grants];
                            updated[index].period = e.target.value;
                            setGrants(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                        />
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addGrant}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Grant
                </Button>
              </div>
            </section>

            {/* Teaching & Advising Section */}
            <section className="space-y-6">
              <div className="space-y-1">
                <h2 className="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider">
                  Teaching & Advising
                </h2>
                <p className="text-xs text-gray-500 dark:text-gray-500">
                  Your teaching experience and student supervision
                </p>
              </div>
              <div className="space-y-6">
                {teachingEntries.map((entry, index) => (
                  <div key={entry.id} className="space-y-4 pb-6 border-b border-gray-100 dark:border-gray-900 last:border-0">
                    <div className="flex justify-between items-center">
                      <span className="text-xs font-medium text-gray-400">Entry {index + 1}</span>
                      {teachingEntries.length > 1 && (
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeTeaching(entry.id)}
                          className="h-7 text-xs text-gray-400 hover:text-red-500"
                        >
                          <Trash2 className="w-3 h-3 mr-1" />
                          Remove
                        </Button>
                      )}
                    </div>
                    <div className="space-y-4">
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Type</Label>
                        <select
                          className="w-full h-10 rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 px-3 py-2 text-sm focus:outline-none focus:border-blossom-400 dark:focus:border-blossom-600 transition-colors"
                          value={entry.type}
                          onChange={(e) => {
                            const updated = [...teachingEntries];
                            updated[index].type = e.target.value;
                            setTeachingEntries(updated);
                          }}
                        >
                          <option value="course">Course</option>
                          <option value="grad-supervision">Graduate Supervision</option>
                          <option value="undergrad-supervision">Undergraduate Supervision</option>
                          <option value="advising">Advising Activities</option>
                        </select>
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Title/Name</Label>
                        <Input
                          placeholder="Course title, student name, or activity description"
                          value={entry.title}
                          onChange={(e) => {
                            const updated = [...teachingEntries];
                            updated[index].title = e.target.value;
                            setTeachingEntries(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600"
                        />
                      </div>
                      <div className="space-y-1.5">
                        <Label className="text-xs font-medium text-gray-700 dark:text-gray-300">Details</Label>
                        <Textarea
                          rows={3}
                          placeholder="Term/year, number of students, thesis title, additional information..."
                          value={entry.details}
                          onChange={(e) => {
                            const updated = [...teachingEntries];
                            updated[index].details = e.target.value;
                            setTeachingEntries(updated);
                          }}
                          className="border-gray-200 dark:border-gray-800 focus:border-blossom-400 dark:focus:border-blossom-600 resize-none"
                        />
                      </div>
                    </div>
                  </div>
                ))}
                <Button
                  onClick={addTeaching}
                  variant="outline"
                  className="w-full border border-dashed border-gray-300 dark:border-gray-700 hover:border-blossom-400 dark:hover:border-blossom-600 text-gray-600 dark:text-gray-400 hover:text-blossom-500"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Teaching Entry
                </Button>
              </div>
            </section>
          </div>
          </div>
        ) : (
          /* Preview Mode: Full-screen Preview */
          <div className="h-screen overflow-y-auto bg-gray-50 dark:bg-gray-900">
            <div className="max-w-7xl mx-auto px-8 py-12">
              {/* Template Selection */}
              <div className="mb-8 flex justify-center gap-4">
                <button
                  onClick={() => setActiveTemplate('modern')}
                  className={`px-6 py-3 text-sm font-medium rounded-full transition-all duration-300 ${
                    activeTemplate === 'modern'
                      ? 'bg-gradient-to-r from-blossom-500 to-pink-600 text-white shadow-lg scale-105'
                      : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700'
                  }`}
                >
                  Modern Template
                </button>
                <button
                  onClick={() => setActiveTemplate('academic')}
                  className={`px-6 py-3 text-sm font-medium rounded-full transition-all duration-300 ${
                    activeTemplate === 'academic'
                      ? 'bg-gradient-to-r from-blossom-500 to-pink-600 text-white shadow-lg scale-105'
                      : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700'
                  }`}
                >
                  Academic Template
                </button>
              </div>

              {/* Preview Content */}
              <div ref={previewRef} className="bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-8 md:p-12">
                {activeTemplate === 'modern' ? (
                  <ModernPreview
                    personalInfo={personalInfo}
                    experiences={experiences}
                    education={education}
                    projects={projects}
                    skills={skills}
                    isAtsMode={isAtsMode}
                  />
                ) : (
                  <AcademicPreview
                    personalInfo={personalInfo}
                    experiences={experiences}
                    education={education}
                    publications={publications}
                    creativeWorks={creativeWorks}
                    grants={grants}
                    teachingEntries={teachingEntries}
                    sectionTitles={sectionTitles}
                    isAtsMode={isAtsMode}
                  />
                )}
              </div>
            </div>

          </div>
        )}
      </div>
    </main>
  );
}
